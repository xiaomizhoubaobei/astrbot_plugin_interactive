# AstrBot 互动游戏插件 - 新增娱乐功能计划文档

**文档版本**: v1.0  
**创建日期**: 2026-02-22  
**作者**: 祁筱欣  
**状态**: 规划中

---

## 📋 目录

1. [项目现状分析](#1-项目现状分析)
2. [功能规划总览](#2-功能规划总览)
3. [Phase 1: 核心功能（推荐立即实施）](#3-phase-1-核心功能推荐立即实施)
4. [Phase 2: 扩展功能（短期规划）](#4-phase-2-扩展功能短期规划)
5. [Phase 3: 进阶功能（中期规划）](#5-phase-3-进阶功能中期规划)
6. [技术实现建议](#6-技术实现建议)
7. [风险评估与应对](#7-风险评估与应对)
8. [附录：数据结构设计](#8-附录数据结构设计)

---

## 1. 项目现状分析

### 1.1 当前功能矩阵

| 类别 | 功能 | 状态 | 用户参与度 |
|------|------|------|-----------|
| 单人游戏 | 猜数字 | ✅ 已上线 | 中 |
| 单人游戏 | 牛牛养成 | ✅ 已上线 | 高 |
| 单人游戏 | 每日签到 | ✅ 已上线 | 高 |
| 随机奖励 | 抽奖系统 | ✅ 已上线 | 中 |
| 经济系统 | 商店/物品 | ✅ 已上线 | 中 |
| 成就系统 | 6个成就 | ✅ 已上线 | 低 |

### 1.2 现有技术架构

- **交互模式**: 纯文本命令式交互
- **状态管理**: 内存 + JSON文件持久化
- **经济系统**: 积分 + 物品双轨制
- **游戏模式**: 单人为主，异步交互

### 1.3 用户痛点分析

1. **游戏类型单一**: 现有游戏偏逻辑/养成，缺少轻松休闲类
2. **社交互动弱**: 缺乏玩家间的直接互动
3. **每日目标不足**: 除签到外，缺少每日必做内容
4. **新鲜感缺失**: 游戏内容固定，缺少随机惊喜

---

## 2. 功能规划总览

### 2.1 规划原则

- **渐进式开发**: 小步快跑，快速验证
- **复用优先**: 最大化复用现有代码和系统
- **数据驱动**: 每个功能都有可量化的目标
- **向后兼容**: 不影响现有功能运行

### 2.2 功能路线图

```
2026 Q1                    2026 Q2                    2026 Q3
  |                          |                          |
  ├─ Phase 1 ────────────────┼──────────────────────────┤
  │  🎣 钓鱼系统 (3周)        │                          │
  │  🎲 幸运转盘 (1周)        │                          │
  │  🌙 每日运势 (1周)        │                          │
  │                          │                          │
  │           ├─ Phase 2 ────┼──────────────────────────┤
  │           │  🧩 猜成语 (2周)                        │
  │           │  🎰 押大小 (1周)                        │
  │           │  ✂️ 石头剪刀布 (2周)                     │
  │           │                                          │
  │           │            ├─ Phase 3 ──────────────────┤
  │           │            │  🏭 打工系统 (2周)           │
  │           │            │  📝 文字冒险 (3周)           │
  │           │            │  🎮 组队副本 (4周)           │
```

### 2.3 功能优先级矩阵

| 功能 | 开发成本 | 用户价值 | 技术风险 | 优先级 |
|------|----------|----------|----------|--------|
| 钓鱼系统 | 中 | 高 | 低 | P0 |
| 幸运转盘 | 低 | 中 | 低 | P0 |
| 每日运势 | 低 | 中 | 低 | P0 |
| 猜成语 | 中 | 中 | 低 | P1 |
| 押大小 | 低 | 中 | 低 | P1 |
| 石头剪刀布 | 中 | 高 | 中 | P1 |
| 打工系统 | 中 | 中 | 低 | P2 |
| 文字冒险 | 高 | 高 | 中 | P2 |

---

## 3. Phase 1: 核心功能（推荐立即实施）

### 3.1 🎣 钓鱼系统

#### 3.1.1 功能概述
玩家可以进行钓鱼活动，获得各种鱼类，可出售换取积分或收藏。与牛牛养成形成"双养成线"。

#### 3.1.2 核心玩法

**基础指令：**
```
fish - 进行一次钓鱼（消耗体力/有CD）
fish sell <鱼名/all> - 出售鱼类
fish bag - 查看鱼篓
fish info <鱼名> - 查看鱼类信息
```

**钓鱼机制：**
- 每次钓鱼消耗 10 点体力
- 体力每30分钟恢复10点（上限100）
- 或使用道具"鱼饵"立即恢复体力
- 钓鱼有30秒冷却时间

**鱼类稀有度设定：**

| 稀有度 | 概率 | 售价范围 | 特点 |
|--------|------|----------|------|
| 普通 | 60% | 5-15积分 | 鲫鱼、草鱼、鲤鱼 |
| 稀有 | 28% | 20-50积分 | 鲈鱼、鳕鱼、鳗鱼 |
| 珍贵 | 10% | 80-150积分 | 金枪鱼、三文鱼、龙虾 |
| 传说 | 1.9% | 300-500积分 | 深海巨鲸、金色传说鱼 |
| 神话 | 0.1% | 1000+积分 | 神秘生物，解锁成就 |

**特殊机制：**
- **连钓奖励**: 连续钓鱼不中断获得额外收益
- **天气系统**: 不同"天气"影响鱼种出现概率
- **鱼王挑战**: 极低概率触发，成功获得大量奖励

#### 3.1.3 与现有系统整合

**经济整合：**
- 鱼类可直接出售换取积分
- 稀有鱼可作为任务道具
- 钓鱼成就加入成就系统

**商店整合：**
新增商品：
- 普通鱼饵：15积分（恢复20体力）
- 高级鱼饵：40积分（恢复50体力，+10%稀有率）
- 幸运浮标：100积分（1小时内+5%传说概率）

**成就整合：**
- 初次钓鱼：钓起第一条鱼
- 钓鱼达人：累计钓鱼100次
- 海王：收集全部10种传说鱼
- 大渔获：单次钓起价值500+积分的鱼

#### 3.1.4 数据结构设计

```json
{
  "user_id": "xxx",
  "fish_data": {
    "stamina": 100,
    "total_caught": 0,
    "fish_bag": {
      "carp": 5,
      "tuna": 1,
      "legend_golden": 0
    },
    "collection": ["carp", "bass"],
    "stats": {
      "common_caught": 50,
      "rare_caught": 20,
      "epic_caught": 5,
      "legendary_caught": 1
    }
  }
}
```

#### 3.1.5 开发周期

| 阶段 | 任务 | 工时 | 交付物 |
|------|------|------|--------|
| D1-2 | 数据结构设计 + 基础框架 | 2天 | 代码框架 |
| D3-5 | 钓鱼核心逻辑 + 随机算法 | 3天 | 可钓鱼版本 |
| D6-7 | 鱼篓系统 + 出售功能 | 2天 | 完整功能 |
| D8-9 | 商店整合 + 成就整合 | 2天 | 系统集成 |
| D10-14 | 测试 + 调优 + 文档 | 5天 | 上线版本 |

**总计：约 2 周**

---

### 3.2 🎲 幸运转盘

#### 3.2.1 功能概述
每日一次的免费抽奖机会，提供固定和随机奖励，提升日活跃度。

#### 3.2.2 核心玩法

**基础指令：**
```
spin - 转动转盘（每日首次免费）
spin pay - 花费20积分额外转动
spin log - 查看最近10次转盘记录
```

**奖励设定：**

| 奖项 | 概率 | 奖励内容 |
|------|------|----------|
| 特等奖 | 0.5% | 500积分 + 限定称号 |
| 一等奖 | 2% | 200积分 + 经验卡 |
| 二等奖 | 7.5% | 100积分 + 抽奖券 |
| 三等奖 | 20% | 50积分 |
| 四等奖 | 30% | 20积分 + 小鱼干（钓鱼体力）|
| 参与奖 | 40% | 10积分 + 安慰道具 |

**特殊规则：**
- 每日0点重置免费次数
- 付费转动每日上限3次
- 连续7天参与获得"转盘老手"成就

#### 3.2.3 与现有系统整合

- 积分直接进入用户账户
- 道具直接进入物品栏
- 成就系统增加转盘相关成就

#### 3.2.4 开发周期

**总计：约 1 周**

---

### 3.3 🌙 每日运势

#### 3.3.1 功能概述
每日生成一次固定的运势结果，增加用户每日互动的仪式感。

#### 3.3.2 核心玩法

**基础指令：**
```
luck - 查看今日运势
luck share - 分享运势到群组
luck week - 查看本周运势趋势（付费功能）
```

**运势生成规则：**
- 基于日期 + 用户ID哈希，确保同一人同一天结果固定
- 运势等级：大吉(10%) / 吉(25%) / 中(40%) / 凶(20%) / 大凶(5%)
- 包含：幸运数字、幸运色、宜做事项、忌做事项

**运势影响（可选）：**
- 大吉：今日首次游戏积分+20%
- 大凶：赠送安慰奖（10积分）

#### 3.3.3 开发周期

**总计：约 3 天**

---

## 4. Phase 2: 扩展功能（短期规划）

### 4.1 🧩 猜成语

#### 4.1.1 功能概述
类似猜数字的文字解谜游戏，展示emoji或文字提示，玩家猜成语。

#### 4.1.2 核心玩法

**基础指令：**
```
idiom - 开始新游戏（随机出题）
idiom hint - 获取提示（消耗5积分）
idiom <答案> - 提交答案
idiom giveup - 放弃本题
idiom rank - 猜成语排行榜
```

**题库设计：**
```json
{
  "id": 1,
  "hint": "🐏 ➡️ 🐯",
  "answer": "羊入虎口",
  "difficulty": "easy",
  "points": 20
}
```

**难度分级：**
- 简单：直接emoji提示（15积分）
- 中等：部分emoji + 文字提示（25积分）
- 困难：纯文字释义（40积分）

#### 4.1.3 开发周期

**总计：约 2 周**（含题库收集）

---

### 4.2 🎰 押大小

#### 4.2.1 功能概述
简单的骰子赌博游戏，3秒出结果，适合快速刺激。

#### 4.2.2 核心玩法

**基础指令：**
```
dice <金额> big - 押大（11-18点）
dice <金额> small - 押小（3-10点）
dice <金额> triple - 押豹子（三同号，1:24赔率）
dice rules - 查看规则
```

**规则：**
- 3个六面骰子，点数和≤10为小，≥11为大
- 豹子（三个相同）：出现概率2.8%，赔率1:24
- 单局下注上限：用户积分的20%或500积分（取小）
- 每日下注次数限制：50次

#### 4.2.3 开发周期

**总计：约 1 周**

---

### 4.3 ✂️ 石头剪刀布

#### 4.3.1 功能概述
支持人机对战和玩家对战的双模式游戏。

#### 4.3.2 核心玩法

**基础指令：**
```
rps - 人机对战（练习模式）
rps <@用户> <金额> - 向某用户发起挑战
rps accept - 接受挑战
rps rank - 查看胜率排行
```

**人机模式：**
- 免费练习，无积分奖励
- 机器人有简单AI（会记录玩家习惯）

**对战模式：**
- 双方下注相同金额
- 胜者获得90%（平台抽成10%）
- 平局退还本金
- 挑战30秒内有效

#### 4.3.3 技术要点

- 需要处理并发挑战状态
- 需要超时机制
- 需要防刷检测

#### 4.3.4 开发周期

**总计：约 2 周**

---

## 5. Phase 3: 进阶功能（中期规划）

### 5.1 🏭 打工系统

#### 5.1.1 功能概述
异步任务系统，接受任务后等待现实时间完成，获得固定收益。

#### 5.1.2 核心玩法

**任务类型：**

| 任务 | 耗时 | 收益 | 要求 |
|------|------|------|------|
| 送外卖 | 10分钟 | 15积分 | 无 |
| 发传单 | 30分钟 | 40积分 | 无 |
| 做家教 | 1小时 | 80积分 | 累计游戏10次 |
| 编程外包 | 4小时 | 300积分 | 猜成语连胜5次 |

**基础指令：**
```
work list - 查看可接任务
work take <任务ID> - 接受任务
work status - 查看当前任务状态
work finish - 完成任务领取奖励
work cancel - 取消当前任务（损失50%押金）
```

#### 5.1.3 开发周期

**总计：约 2 周**

---

### 5.2 📝 文字冒险（迷你地下城）

#### 5.2.1 功能概述
轻量级Roguelike文字冒险，每次随机生成地图和事件。

#### 5.2.2 核心玩法

**游戏流程：**
```
dungeon start - 开始冒险（消耗20积分入场费）
  ↳ 生成3层地下城，每层3-5个节点
  ↳ 节点类型：战斗/宝箱/事件/商店/休息点
  ↳ 到达第3层终点获得通关奖励
```

**角色属性：**
- HP：生命值（战斗消耗）
- ATK：攻击力（影响战斗）
- LUCK：幸运（影响事件结果）
- 初始属性基于用户等级/成就

**奖励：**
- 通关奖励：100-300积分 + 稀有道具
- 中途退出：保留已获得物品

#### 5.2.3 开发周期

**总计：约 3 周**

---

### 5.3 🎮 组队副本（长期规划）

#### 5.3.1 功能概述
多人协作PVE玩法，需要好友系统支持。

#### 5.3.2 前置条件
- 好友系统已完成
- 消息推送机制完善

#### 5.3.3 开发周期

**总计：约 4 周**

---

## 6. 技术实现建议

### 6.1 代码结构建议

```
commands/
├── fish.py          # 钓鱼系统
├── spin.py          # 幸运转盘
├── luck.py          # 每日运势
├── idiom.py         # 猜成语
├── dice.py          # 押大小
├── rps.py           # 石头剪刀布
├── work.py          # 打工系统
└── dungeon.py       # 文字冒险

data/
├── fish_data.py     # 鱼类数据管理
├── idiom_bank.py    # 成语题库
├── dungeon_gen.py   # 地下城生成器
└── luck_engine.py   # 运势生成器

config/
├── fish_config.py   # 钓鱼配置
├── spin_config.py   # 转盘奖励配置
└── dungeon_config.py # 冒险事件配置
```

### 6.2 公共组件封装

建议封装以下公共组件供新功能使用：

```python
# utils/game_utils.py
class GameUtils:
    @staticmethod
    def check_cooldown(user_id: str, action: str, cooldown_sec: int) -> bool:
        """检查操作冷却时间"""
        
    @staticmethod
    def weighted_random(choices: list, weights: list) -> any:
        """带权重的随机选择"""
        
    @staticmethod
    def format_reward(reward: dict) -> str:
        """格式化奖励显示"""
```

### 6.3 配置化管理

所有游戏参数应放入配置文件，支持热更新：

```python
# config/new_features.py
FISH_CONFIG = {
    "stamina_cost": 10,
    "stamina_regen_minutes": 30,
    "cooldown_seconds": 30,
    "rarity_weights": {
        "common": 60,
        "rare": 28,
        "epic": 10,
        "legendary": 1.9,
        "mythic": 0.1
    }
}

SPIN_CONFIG = {
    "daily_free": 1,
    "paid_limit": 3,
    "cost": 20,
    "rewards": [...]
}
```

---

## 7. 风险评估与应对

### 7.1 风险矩阵

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 题库版权问题 | 中 | 高 | 使用公开领域/原创题库 |
| 赌博性质敏感 | 中 | 高 | 押大小限制次数/金额，添加防沉迷提示 |
| 数据膨胀 | 高 | 中 | 定期归档旧数据，设置存储上限 |
| 并发冲突 | 中 | 中 | 使用文件锁或迁移到数据库 |

### 7.2 合规性建议

- **押大小功能**：
  - 明确标注"仅供娱乐，理性游戏"
  - 设置每日/每周积分损失上限
  - 禁止真实货币交易

- **玩家对战**：
  - 记录日志，防止恶意刷分
  - 设置举报机制

---

## 8. 附录：数据结构设计

### 8.1 用户数据扩展

```json
{
  "user_id": "platform:123456",
  "points": 1000,
  "inventory": [...],
  "cow": {...},
  
  "new_features": {
    "fish": {
      "stamina": 100,
      "last_regen": 1709100000000,
      "fish_bag": {},
      "stats": {}
    },
    "spin": {
      "last_spin_date": "2026-02-22",
      "daily_used": 0,
      "paid_used": 0,
      "total_spins": 50
    },
    "luck": {
      "last_check_date": "2026-02-22",
      "history": []
    },
    "rps": {
      "wins": 10,
      "losses": 5,
      "draws": 2,
      "win_streak": 3
    }
  }
}
```

### 8.2 配置文件结构

```yaml
# config/new_features.yml
fish:
  enabled: true
  stamina:
    max: 100
    cost: 10
    regen_rate: 10
    regen_interval_minutes: 30
  cooldown_seconds: 30
  rarity_weights:
    common: 60
    rare: 28
    epic: 10
    legendary: 1.9
    mythic: 0.1

spin:
  enabled: true
  daily_free: 1
  paid_limit: 3
  cost: 20
  rewards:
    - tier: 1
      probability: 0.005
      rewards:
        points: 500
        title: "天选之人"

luck:
  enabled: true
  fortune_weights:
    great: 0.10
    good: 0.25
    normal: 0.40
    bad: 0.20
    terrible: 0.05
```

---

## 📌 总结

本计划文档提供了8个新娱乐功能的详细规划，覆盖：

- **Phase 1（立即实施）**: 钓鱼、转盘、运势 - 预计1个月完成
- **Phase 2（短期）**: 猜成语、押大小、石头剪刀布 - 预计1.5个月完成
- **Phase 3（中期）**: 打工、文字冒险、组队 - 预计2个月完成

**建议启动顺序：**
1. 先做 **幸运转盘**（1周，快速提升日活）
2. 再做 **钓鱼系统**（2周，核心养成玩法）
3. 接着 **每日运势**（3天，仪式感）
4. 根据用户反馈选择 Phase 2 功能

---

**文档维护记录**

| 版本 | 日期 | 更新内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2026-02-22 | 初始版本 | 祁筱欣 |

---

*本文档为规划性质，实际开发中可根据资源情况和用户反馈调整优先级。*
