# 谁是卧底 - 开发文档

## 功能概述

谁是卧底是一个多人互动游戏，玩家需要通过描述词汇找出与众不同的"卧底"。简化版由AI扮演其他玩家，支持单人对战。

## 需求分析

### 功能需求

#### 核心功能
- 玩家分配：分配平民和卧底身份
- 描述阶段：轮流描述词汇
- 投票阶段：投票选出卧底
- AI玩家：AI模拟其他玩家行为
- 简化模式：单人游戏

#### 游戏规则
- 4人局：3平民1卧底
- 5人局：4平民1卧底
- 每轮描述后投票
- 卧底获胜条件：活到最后或平票
- 平民获胜条件：投出卧底

#### 奖励机制
- 平民获胜：20积分
- 卧底获胜：30积分（更难）
- 参与奖励：5积分

### 非功能需求
- 响应时间：<2秒
- 词汇库：≥100对词汇
- AI智能度：中等

## 技术设计

### 数据结构

```python
# 词汇数据
{
    "common_word": "str",     # 平民词
    "spy_word": "str",        # 卧底词
    "category": "str",        # 分类
    "difficulty": "int"       # 难度
}

# 游戏状态
{
    "game_id": "str",
    "user_id": "str",
    "player_role": "str",     # 用户身份（common/spy）
    "player_word": "str",     # 用户词汇
    "ai_players": "list",     # AI玩家
    "round": "int",           # 当前回合
    "votes": "dict",          # 投票记录
    "status": "playing|finished"
}
```

### 模块设计

```
who_is_spy/
├── __init__.py
├── data/
│   └── word_pairs.py         # 词汇对库
├── logic/
│   ├── spy_game.py           # 游戏逻辑
│   ├── ai_player.py          # AI玩家
│   └── voting_system.py      # 投票系统
└── command/
    └── spy_command.py        # 命令处理
```

### 接口设计

#### 命令接口
```
spy start                    # 开始游戏
spy describe <描述>           # 描述词汇
spy vote <玩家编号>           # 投票
spy status                    # 查看状态
```

### 配置项

```yaml
spy_game:
  min_players: 4             # 最小玩家数
  max_players: 6             # 最大玩家数
  rounds: 3                  # 最大回合数
  ai_think_time: 2           # AI思考时间
  rewards:
    common_win: 20           # 平民获胜
    spy_win: 30              # 卧底获胜
    participation: 5          # 参与奖励
```

## 实现步骤

### 阶段一：数据准备（1天）
1. 收集词汇对
2. 分类整理
3. 创建词汇库

### 阶段二：核心逻辑（2天）
1. 实现游戏流程
2. 实现AI玩家
3. 实现投票系统
4. 实现胜负判定

### 阶段三：命令处理（1天）
1. 实现命令解析
2. 实现用户交互
3. 优化显示效果

### 阶段四：测试优化（1天）
1. 功能测试
2. AI测试
3. 用户测试

## 预期效果

- 用户参与度：+10%
- 平均游戏时长：3-5分钟
- 完成率：≥75%
- 用户满意度：≥85%

---

**文档版本**: v1.0  
**创建日期**: 2026-02-22